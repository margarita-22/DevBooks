# [22-05-17] Clean Code 9, 10장 TIL

생성일: 2022년 5월 16일 오후 10:38
태그: 스터디

# Clean Code 9, 10장

- 2022-05-17
    - 9장 단위테스트, 10장 클래스

**책에서 기억하고 싶은 내용을 써보세요.**

- 9장 단위테스트
    - TDD 법칙
        - 실패하는 단위 테스트를 작성할 때까지 실제 코드를 작성하지 않는다.
        - 컴파일은 실패하지 않으면서 실행이 실패하는 정도로만 단위테스트를 작성한다.
        - 현재 실패하는 테스트를 통과할 정도로만 실제 코드를 작성한다.
    - 의도하지 않은 결함 수가 많아지면 개발자는 변경을 주저한다.
    - 테스트는 유연성, 유지보수성, 재사용성을 제공한다.
    - 테스트 케이스가 없으면 개발자는 변경을 주저한다. 버그가 숨어들까 두렵기 때문이다.
    - 깨끗한 테스트 코드 (조건? )
        - 도메인에 특화된 테스트 언어
        - 이중 표준
            - 테스트 코드는 실제 코드와 확실히 다르고, 간결하고 표현력이 풍부해야하지만 실제 코드만큼 효율적일 필요는 없다.
            - 실제 환경에서는 절대로 안되지만 테스트 환경에서는 전혀 문제없는 방식이 있다. 대개 메모리나 CPU 효율과 관련 있는 경우다. 코드의 깨끗함과는 철저히 무관하다.
    - 테스트 당 assert 하나씩 사용.
        - 테스트 당 개념 하나 [ 테스트 함수마다 한 개념만 테스트하라]
    - F.I.R.S.T
        - Fast 빠르게 : 테스트는 빠르게 실행되어야 한다.
        - Independent 독립적으로 : 테스트는 서로 의존하지 않고 독립적이어야 하고 실행 순서와 관계 없어야 한다.
        - Repeatable 반복가능하게 : 어떤 환경에서도 반복해서 실행할 수 있어야 한다.
        - Self-Validating 자가검증하는 : 성공 / 실패 이어야 한다. 이 외의 것으로 판단해야한다면 주관적이게 된다.
        - Timely 적시에 : 테스트하려는 실제 코드를 구현하기 직전에 구현한다.
            - 테스트코드 → 실제 코드 (기능1)  → 테스트코드 → 실제 코드 (기능 2) .....
    - 테스트 코드는 실제 코드만큼이나 프로젝트 건강에 중요하다.  (...) 실제 코드의 유연성, 유지보수성, 재사용성을 보존하고 강화한다. 테스트 코드는 깨끗하게 관리하자. 표현력을 높이고 간결하게 정리하자. 테스트  API를 구현하여 도메인 특화 언어(DSL)를 만들자.
    - 테스트 코드가 방치되어 망가지면 실제 코드도 망가진다.
        
        
    
- 10장 클래스
    - 클래스 체계
        - public static → private static → private ... (public...? 거의 없다.) [여기까지 변수] → public Function → private Function
        - 추상화 단계가 순차적으로 내려간다.
    - 클래스는 작아야 한다.
        - 클래스가 맡은 책임을 세어, 책임이 많다면 클래스를 나누어 클래스의 책임을 줄인다.
        - 작명은 클래스 크기를 줄이는 첫 번째 관문이다.
        - 단일 책임 원칙 :
            - 클래스나 모듈을 변경할 이유는 단 하나여야 한다. (함수에서도 언급되었음 그만큼 중요한..)
            - 클래스를 변경할 이유를 파악하려 하다 보면 코드를 추상화하기도 쉬워진다.
    - 소프트웨어를 돌아가게 만드는 활동과 소프트웨어를 깨끗하게 만드는 활동은 완전히 별개다.
        - 돌아가는 소프트웨어에 초점을 맞춘다 (...) 프로그램이 돌아가면 일이 끝났다고 여김. 깨끗하고 체계적인 소프트웨어라는 다음 관심사로 전환하지 않는다.
        - 클래스가 많건 (작은 클래스) 적건 (큰 클래스) 그 양은 비슷하다. (...) 복잡성을 다루려면 체계적인 정리가 필수이고, (...) 그 양이 비슷하다면 작은 클래스 여럿이 큰 클래스 몇개보다 더 바람직하다.
        - 응집도
            - 클래스 메서드는 클래스 인스턴스 변수를 하나 이상 사용해야 한다.
            - 메서드가 변수를 더 많이 사용할수록 메서드와 클래스는 응집도가 더 높다.
            - 응집도가 높다 :  클래스에 속한 메서드와 변수가 서로 의존하며 논리적인 단위로 묶인다.
        - 응집도를 유지하면 작은 클래스 여럿이 나온다. → 클래스가 응집력을 잃으면 쪼개라.
    - 변경하기 쉬운 클래스
        - 이상적인 시스템이라면 새 기능을 추가할 때 시스템을 확장할 뿐 기존 코드를 변경하지는 않는다.
        - 변경으로부터 격리 : 상세한 구현에 의존하는 코드는 테스트가 어렵다.
            
            → 시스템의 결합도를 낮추면 유연성과 재사용성도 높아진다. 
            
            결합도가 낮다 : 
            
            - 각 시스템 요소가 다른 요소로부터, 변경으로부터 잘 격리되어있음
                
                →  각 요소를 이해하기 더 쉽다.
                

**오늘 읽은 소감은? 떠오르는 생각을 가볍게 적어보세요**

- 내가 하던 것은 테스트라고 할 수 없는 것 같다. 뭘 끄적이고, 그게 요청한 내용대로 작동하는 지만, 적당히 짐작할 수 있는 이상 행동만 잠깐 체크한..  변경을 주저한다는 내용도, 테스트케이스를 제대로 체크하지 않았으니, 또 어떤 영향을 미칠 지 짐작하지 못했고... 그래서 변경요청이 그렇게 부담스러웠던거다. 코드를 정리한다고 정리하고도 (객관적으로 나아졌다고 자신할 수는 없지만 전보다는 보기 쉬워진..) 실제로 적용하기에는 변경하기가 너무 염려되어 적용을 못한 수정본도 여러 개 있다.
    - 그것들을 테스트코드 개발 방식으로 다시 리팩토링 해보면 좋지않을까
- 여전히 비슷하게도 어렵긴 하지만, 앞의 몇 장을 보았다고 그런지 진짜 쉽게 해줘서 그런지 코드를 다시 정리해보았다 ~ 구간이 앞 장을 읽을 때 보다는 좀 더 잘 이해되었다. 이제 이렇게 코드도 짤 수 있으면 참 좋을텐데;;;
- 테스트 코드 이야기를 하면서.. 테스트코드까지 어떻게 잘 짜야될까 하고서 또 한번에 완벽하게 할 수는 없다고 앞에 나왔던 응원어린 문구를 까맣게 잊은 채 막막해했다. 코드를 어떻게 짜야하나, 완전 잘 짜인 코드를 두가지 타입으로나 짜야한다니 부담이 한가득이었다.
    
    그런데 깨끗한 테스트 코드 (조건??) 부분에서 실제 코드만큼 효율적이지 않아도 되고.. 실제 환경과는 다르다는 내용을 보고 또 한번에 잘 하려고 했다는 사실에.. 어휴 ㅠ 
    
- 테스트코드가 망가지면 실제 코드가 망가진다. 명제를 대우로 만들면 실제 코드가 좋다면 테스트 코드도 좋다.  망가질 테스트 코드가 없으니...... 오류가 발생해도 그걸 모두 내 기억에 의존해야한다는 점.. 내가 정말 다 기억한다고 해도, 다른 사람은 그렇지 않을 수 있다는 점... 어떻게 시작해봐야할까
- 클래스는 함수와 비슷한 느낌이었다. 작아야한다. 작아야한다. 사용하지 않는 것이 있으면 안된다. 작은게 여러개인거나 큰게 몇개인거나 양은 비슷하다는 문장을 보고 헉 했다. 지금 하는 것 중에 정말 말도안되게 큰 클래스..(VO)가 하나 있는데, 묶어서 줄여보려다가 막혀서 우회하고.. 정체되어있는 게 생각났다. 왜 쪼갤 생각을 하지 못했을까?
- 소수를 구하는 클래스를 나누어 리팩토링 한 예제를 보니 더 잘 와닿았다. 네이밍은 클래스 이해에 중요하고 (반대로 난독화를 왜 하는지도 다시 한 번 이해했다 ㅋ ㅋ 봐도 머리아파..) 클래스가담는 의미 자체가 어렵고 복잡하여도 내용을 이해하기가 좀 더 쉬워졌다.
- 그럼에도 ~ 궁금한 내용 체크하는 것에 디자인 패턴, 설계 원칙 이런 cs 내용들에서 속도는 급브레이크를 밟은 것 마냥 느려진다. 익혀놓아야겠다. (책 볼때마다 생각하기..) 괜히 기본이 아닌듯
- 복습단계를.. 꼭 거쳐야겠다.. → 용어들에 대해서 완전히 숙지하지를 못하니까 봤던 용어 또 찾아보는 문제가 생긴다. 습관을 안들여놓으면 공부할 때 제일 어려운게 복습인듯하다

**궁금한 내용이 있거나, 잘 이해되지 않는 내용이 있다면 적어보세요.**

- BUILD-OPERATE-CHECK
    - 첫번째 파트에서 테스트 데이터를 빌드하고, 두번째 파트에서 테스트 데이터에 작동하고, 세번째 파트에서 작동 결과가 기대한대로 나왔는지 체크
- given-where-then
    - BDD(Behaviour-Driven Development) 중 하나
        - Given : 시나리오 진행에 필요한 값을 설정, 테스트의 상태를 설정
        - When : 시나리오 진행 필요 조건 명시, 테스트하고자 하는 행동
        - Then : 시나리오를 완료했을 때 보장해야하는 결과를 명시, 예상되는 변화 설명
    
    출처: [https://life-shelter.tistory.com/319](https://life-shelter.tistory.com/319)
    
- GOF 디자인 패턴 ([https://i5i5.tistory.com/537](https://i5i5.tistory.com/537)) ([https://4z7l.github.io/2020/12/25/design_pattern_GoF.html](https://4z7l.github.io/2020/12/25/design_pattern_GoF.html))

- OCP (Open-Closed Principle)
- DIP (Dependency Inversion Principle)
    - 상세한 구현이 아니라 추상화에 의존해야한다.